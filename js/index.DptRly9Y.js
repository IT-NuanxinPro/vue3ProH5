import{r,q as ue,s as me,l as g,m as o,v as pe,x as ve,f as i,y as we,A as ge,F as H,B as J,h as b,e as V,t as u,C as he,d as fe,T as ye,D as Me,G as _e,o as h,H as U,u as ke,I as Ae}from"./vendor.QmseAAYN.js";import{_ as Ce}from"./index.DTnjPOn2.js";function Le(){const D=r(!1),M=r(""),k=r(!1);let T=null;return{showToast:p=>{if(T){clearTimeout(T);const l=document.querySelector(".custom-toast");l&&document.body.removeChild(l)}typeof p=="string"?(M.value=p,k.value=!1):(M.value=p.message,k.value=p.forbidClick||!1);const d=document.createElement("div");if(d.className="custom-toast",d.textContent=M.value,k.value){const l=document.createElement("div");l.className="toast-overlay",document.body.appendChild(l)}document.body.appendChild(d),D.value=!0,d.offsetHeight,d.style.opacity="1";const v=typeof p=="object"&&p.duration||2500;T=window.setTimeout(()=>{d.classList.add("fade-out"),setTimeout(()=>{if(document.body.removeChild(d),k.value){const l=document.querySelector(".toast-overlay");l&&document.body.removeChild(l)}D.value=!1,k.value=!1},200)},v)},showLoadingToast:p=>{console.log("显示 loading:",p);const d=typeof p=="string"?{message:p,forbidClick:!0}:{...p,forbidClick:!0},v=document.createElement("div");v.className="custom-toast loading-toast";const l=document.createElement("div");if(l.className="loading-spinner",v.appendChild(l),d.message){const w=document.createElement("div");w.className="loading-message",w.textContent=d.message,v.appendChild(w)}if(d.forbidClick){const w=document.createElement("div");w.className="toast-overlay",document.body.appendChild(w)}return document.body.appendChild(v),v.offsetHeight,v.style.opacity="1",()=>{v.classList.add("fade-out"),setTimeout(()=>{document.body.removeChild(v);const w=document.querySelector(".toast-overlay");w&&document.body.removeChild(w)},200)}}}}const be={class:"map-search"},Te={class:"search-box"},xe={class:"search-input-wrapper"},Se={class:"input-container"},Pe={key:0,class:"search-tips"},$e=["onClick"],Ie=["innerHTML"],ze={class:"district"},De={key:0,class:"distance-info"},Re={class:"view-text"},Ee={class:"address-list"},Be=["onClick"],Ne={class:"title"},qe={class:"label"},He={key:1,class:"empty-status"},Ve={key:0,class:"travel-info"},Ue={class:"travel-cards"},We={class:"info"},Fe={class:"distance"},je={class:"time"},Xe={class:"info"},Ye={class:"distance"},Ke={class:"time"},Ge={class:"info"},Je={class:"distance"},Oe={class:"time"},Ze={key:2,class:"weather-info"},Qe={class:"weather-content"},et={class:"current-weather"},tt={class:"temperature"},nt={class:"weather"},ot={class:"weather-detail"},at={__name:"index",setup(D){const{showToast:M,showLoadingToast:k}=Le();function T(t,e){let a=null;return function(...s){a&&clearTimeout(a),a=setTimeout(()=>{t.apply(this,s)},e)}}const m=r(""),_=r([]);let p=null;const d=r([]),v=ke(),l=r(null),w=r(""),f=r({driving:{distance:"等待搜索...",time:"等待搜索..."},riding:{distance:"等待搜索...",time:"等待搜索..."},walking:{distance:"等待搜索...",time:"等待搜索..."}}),A=r(""),x=r(!1),O=r(!1),S=r(!0),P=r({top:"235px",right:"24px"}),R=r(!1),W=r(0),F=r(0),j=r(0),X=r(0),Z=t=>{R.value=!0,W.value=t.touches[0].clientY,F.value=t.touches[0].clientX,j.value=parseInt(P.value.top),X.value=parseInt(P.value.right)},Q=t=>{if(!R.value)return;const e=t.touches[0].clientY-W.value,a=t.touches[0].clientX-F.value;let s=j.value+e,n=X.value-a;const c=window.innerHeight-50;s=Math.max(60,Math.min(s,c)),n=Math.max(0,Math.min(n,window.innerWidth-50)),P.value={top:`${s}px`,right:`${n}px`},t.cancelable&&requestAnimationFrame(()=>{t.preventDefault()})},ee=()=>{R.value=!1},C=r(!0),E=t=>{t===A.value&&C.value||(B(),A.value=t,C.value=!0,Y(t))},B=()=>{window.driving&&window.driving.clear(),window.riding&&window.riding.clear(),window.walking&&window.walking.clear()},Y=t=>{if(B(),!C.value)return;const e=window[t];if(e&&l.value&&window.marker){const a=window.marker.getPosition(),s=new AMap.LngLat(l.value[0],l.value[1]),n=new AMap.LngLat(a.getLng(),a.getLat());e.search(s,n,(c,y)=>{c==="complete"&&y.routes&&y.routes[0]?(e.clear(),e.search(s,n,{showMarker:!1,waypoints:[],autoFitView:!1})):console.error(`${t} 路线规划失败:`,c,y)})}},te=t=>{B(),window.marker&&window.marker.setMap(null);const e=new AMap.LngLat(t[0],t[1]);if(window.marker=new AMap.Marker({position:e,icon:new AMap.Icon({size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34),image:"//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-red.png"}),offset:new AMap.Pixel(-12,-34),zIndex:2}),window.marker.setMap(window.map),window.map.setCenter(e),l.value){const a=t[0]===l.value[0]&&t[1]===l.value[1];O.value=!a,a||(ne(t),C.value&&Y(A.value))}},N=t=>t<1e3?`${Math.round(t)}米`:`${(t/1e3).toFixed(1)}公里`,q=t=>{const e=Math.floor(t/3600),a=Math.ceil(t%3600/60);return e>0?`约${e}小时${a}分钟`:`约${a}分钟`},$=()=>new Promise((t,e)=>{if(!m.value.trim())return M("请输入搜索地址"),Promise.reject("empty input");_.value=[],window.placeSearch.search(m.value,(a,s)=>{a==="complete"&&s.poiList&&s.poiList.pois&&s.poiList.pois.length>0?(d.value=s.poiList.pois.map(n=>({id:n.id||Math.random().toString(36).substr(2,9),name:n.name||"未知地点",address:n.address||"暂无地址",location:n.location?[n.location.lng,n.location.lat]:l.value})),d.value.length>0&&(x.value=!0,K(d.value[0],!0)),t()):(M("未找到相关地址"),d.value=[],e(new Error("搜索失败")))})}),ne=t=>{if(!l.value)return;const e=new AMap.LngLat(l.value[0],l.value[1]),a=new AMap.LngLat(t[0],t[1]);window.driving.search(e,a,(s,n)=>{if(s==="complete"&&n.routes&&n.routes[0]){const c=n.routes[0];f.value.driving={distance:N(c.distance),time:q(c.time)}}}),window.riding.search(e,a,(s,n)=>{if(s==="complete"&&n.routes&&n.routes[0]){const c=n.routes[0];f.value.riding={distance:N(c.distance),time:q(c.time)}}}),window.walking.search(e,a,(s,n)=>{if(s==="complete"&&n.routes&&n.routes[0]){const c=n.routes[0];f.value.walking={distance:N(c.distance),time:q(c.time)}}})},oe=()=>{if(S.value=!S.value,window.map){const t=S.value?45:0;window.map.setPitch(t)}},L=r(null),ae=()=>{if(!window.AMap)return;new AMap.Weather().getLive("天津",(e,a)=>{e?console.error("获取天气信息失败：",e):L.value=a})},ie=async()=>{const t=k({message:"加载中...",forbidClick:!0});try{const{address:e}=v.query,a=[117.26673,39.069586];let s=a;if(!e&&navigator.geolocation)try{const z=await se();s=[z.coords.longitude,z.coords.latitude]}catch(z){console.error("获取位置失败：",z),M("定位失败，使用默认位置"),s=a}l.value=s,window._AMapSecurityConfig={securityJsCode:"d71d134ad30466716eba94c299f43ee8"},await Me.load({key:"d61c96ab9e393a548ca4d1e14272ce64",version:"2.0",plugins:["AMap.PlaceSearch","AMap.Scale","AMap.ToolBar","AMap.ControlBar","AMap.GeometryUtil","AMap.Driving","AMap.Walking","AMap.Riding","AMap.Weather","AMap.AutoComplete"]}),window.map=new AMap.Map("container",{viewMode:"3D",zoom:14,center:s,pitch:45});const n=new AMap.Scale({position:{left:"5px",bottom:"5px"}});window.map.addControl(n);const c=new AMap.ToolBar({position:{right:"28px",top:"100px"}});window.map.addControl(c);const y=new AMap.ControlBar({position:{right:"0px",top:"0px"}});window.map.addControl(y),window.placeSearch=new AMap.PlaceSearch({city:"天津",pageSize:10,pageIndex:1}),window.driving=new AMap.Driving({policy:AMap.DrivingPolicy.LEAST_TIME,map:window.map}),window.riding=new AMap.Riding({map:window.map}),window.walking=new AMap.Walking({map:window.map}),le(l.value),e&&(m.value=e,x.value=!0,await $()),ae(),p=new AMap.AutoComplete({city:"天津",citylimit:!0,input:""}),t(),I.value=!1}catch(e){console.error("地图初始化失败：",e),M("地图加载失败"),t(),I.value=!1}},se=()=>new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(a=>t(a),a=>e(a),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}),le=t=>{window.currentLocationMarker&&window.currentLocationMarker.setMap(null);const e=new AMap.LngLat(t[0],t[1]);window.currentLocationMarker=new AMap.Marker({position:e,icon:new AMap.Icon({size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34),image:"//webapi.amap.com/theme/v1.3/markers/b/mark_bs.png"}),offset:new AMap.Pixel(-12,-34),zIndex:1}),window.currentLocationMarker.setMap(window.map)},K=(t,e=!1)=>{e||(m.value=t.name),te(t.location),window.map.setZoom(14),x.value=!0,A.value=""},G=T(async()=>{if(!m.value.trim()){_.value=[];return}p.search(m.value,(t,e)=>{t==="complete"&&e.tips?_.value=e.tips:_.value=[]})},300),re=t=>{if(!m.value.trim())return t;const e=m.value.trim(),a=new RegExp(e,"gi");return t.replace(a,s=>`<span class="highlight">${s}</span>`)},ce=t=>{m.value=t.name,_.value=[],$()};ue(()=>{ie(),document.addEventListener("click",t=>{const e=document.querySelector(".search-box");e!=null&&e.contains(t.target)||(_.value=[])})}),me(()=>{window.map&&(window.map.destroy(),window.map=null,window.marker=null,window.currentLocationMarker=null,window.placeSearch=null,window.driving=null,window.riding=null,window.walking=null)});const I=r(!0),de=()=>{if(!window.marker){M("请先选择目的地");return}const t=window.marker.getPosition(),e=t.getLat(),a=t.getLng(),s=m.value,n=`androidamap://navi?sourceApplication=appname&poiname=${encodeURIComponent(s)}&lat=${e}&lon=${a}&dev=0&style=2`,c=`https://uri.amap.com/navigation?to=${a},${e},${encodeURIComponent(s)}&mode=car&coordinate=gaode&callnative=1`,y=window.open(n);setTimeout(()=>{y&&!y.closed&&(y.close(),window.location.href=c)},2e3)};return(t,e)=>{const a=_e,s=Ae;return h(),g("div",be,[o("div",Te,[o("div",xe,[o("div",Se,[pe(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>we(m)?m.value=n:null),placeholder:"请输入地址",class:"search-input",onKeyup:ge($,["enter"]),onInput:e[1]||(e[1]=(...n)=>i(G)&&i(G)(...n))},null,544),[[ve,i(m)]]),i(_).length?(h(),g("div",Pe,[(h(!0),g(H,null,J(i(_),(n,c)=>(h(),g("div",{key:c,class:"tip-item",onClick:y=>ce(n)},[o("div",{class:"name",innerHTML:re(n.name)},null,8,Ie),o("div",ze,u(n.district),1)],8,$e))),128))])):b("",!0)]),o("button",{class:"search-btn",onClick:$},"搜索")])]),e[9]||(e[9]=o("div",{id:"container"},null,-1)),i(w)?(h(),g("div",De,[V(a,{title:i(w)},null,8,["title"])])):b("",!0),i(I)?b("",!0):(h(),g("div",{key:1,class:"view-toggle-btn",onClick:oe},[o("span",Re,u(i(S)?"3D":"2D"),1)])),o("div",Ee,[i(I)?b("",!0):(h(),g(H,{key:0},[i(d).length?(h(!0),g(H,{key:0},J(i(d),n=>(h(),g("div",{key:n.id,class:"address-item",onClick:c=>K(n)},[o("div",Ne,u(n.name),1),o("div",qe,u(n.address),1)],8,Be))),128)):(h(),g("div",He,e[5]||(e[5]=[o("img",{src:"https://fastly.jsdelivr.net/npm/@vant/assets/custom-empty-image.png",class:"empty-image"},null,-1),o("p",{class:"empty-text"},"暂无地址数据",-1)])))],64))]),o("div",{class:"nav-btn",onTouchstartPassive:Z,onTouchmovePassive:Q,onTouchendPassive:ee,style:he(i(P)),onClick:de},[V(s,{name:"guide-o",size:"24"})],36),V(ye,{name:"slide"},{default:fe(()=>[i(x)&&i(f).driving?(h(),g("div",Ve,[o("div",Ue,[o("div",{class:U(["travel-card",{active:i(A)==="driving"&&i(C)}]),onClick:e[2]||(e[2]=n=>E("driving"))},[e[6]||(e[6]=o("div",{class:"mode-icon"},"🚗",-1)),o("div",We,[o("div",Fe,u(i(f).driving.distance),1),o("div",je,u(i(f).driving.time),1)])],2),o("div",{class:U(["travel-card",{active:i(A)==="riding"&&i(C)}]),onClick:e[3]||(e[3]=n=>E("riding"))},[e[7]||(e[7]=o("div",{class:"mode-icon"},"🚲",-1)),o("div",Xe,[o("div",Ye,u(i(f).riding.distance),1),o("div",Ke,u(i(f).riding.time),1)])],2),o("div",{class:U(["travel-card",{active:i(A)==="walking"&&i(C)}]),onClick:e[4]||(e[4]=n=>E("walking"))},[e[8]||(e[8]=o("div",{class:"mode-icon"},"🚶",-1)),o("div",Ge,[o("div",Je,u(i(f).walking.distance),1),o("div",Oe,u(i(f).walking.time),1)])],2)])])):b("",!0)]),_:1}),i(L)?(h(),g("div",Ze,[o("div",Qe,[o("div",et,[o("span",tt,u(i(L).temperature)+"°",1),o("span",nt,u(i(L).weather),1)]),o("div",ot,[o("span",null,"湿度 "+u(i(L).humidity)+"%",1),o("span",null,u(i(L).windDirection)+"风 "+u(i(L).windPower)+"级",1)])])])):b("",!0)])}}},lt=Ce(at,[["__scopeId","data-v-2cce18ed"]]);export{lt as default};
