import{r as d,q as fe,s as he,l as f,m as o,v as ke,x as ye,f as l,y as Q,A as Me,F as j,B as ee,h as x,e as $,t as u,C as _e,d as te,T as Ce,D as be,G as Ae,P as Le,o as h,H as F,u as $e,I as Te}from"./vendor.PTwOvzD9.js";import{_ as xe}from"./index.CwU4Bte0.js";function Se(){const E=d(!1),k=d(""),C=d(!1);let S=null;return{showToast:m=>{if(S){clearTimeout(S);const r=document.querySelector(".custom-toast");r&&document.body.removeChild(r)}typeof m=="string"?(k.value=m,C.value=!1):(k.value=m.message,C.value=m.forbidClick||!1);const c=document.createElement("div");if(c.className="custom-toast",c.textContent=k.value,C.value){const r=document.createElement("div");r.className="toast-overlay",document.body.appendChild(r)}document.body.appendChild(c),E.value=!0,c.offsetHeight,c.style.opacity="1";const w=typeof m=="object"&&m.duration||2500;S=window.setTimeout(()=>{c.classList.add("fade-out"),setTimeout(()=>{if(document.body.removeChild(c),C.value){const r=document.querySelector(".toast-overlay");r&&document.body.removeChild(r)}E.value=!1,C.value=!1},200)},w)},showLoadingToast:m=>{console.log("显示 loading:",m);const c=typeof m=="string"?{message:m,forbidClick:!0}:{...m,forbidClick:!0},w=document.createElement("div");w.className="custom-toast loading-toast";const r=document.createElement("div");if(r.className="loading-spinner",w.appendChild(r),c.message){const g=document.createElement("div");g.className="loading-message",g.textContent=c.message,w.appendChild(g)}if(c.forbidClick){const g=document.createElement("div");g.className="toast-overlay",document.body.appendChild(g)}return document.body.appendChild(w),w.offsetHeight,w.style.opacity="1",()=>{w.classList.add("fade-out"),setTimeout(()=>{document.body.removeChild(w);const g=document.querySelector(".toast-overlay");g&&document.body.removeChild(g)},200)}}}}const Pe={class:"map-search"},Ie={class:"search-box"},ze={class:"search-input-wrapper"},Re={class:"input-container"},De={key:0,class:"search-tips"},Ee=["onClick"],qe=["innerHTML"],Ne={class:"district"},Ue={key:0,class:"distance-info"},Be={class:"view-text"},He={class:"address-list"},Ve=["onClick"],We={class:"title"},je={class:"label"},Fe={key:1,class:"empty-status"},Xe={class:"map-selector"},Ye={class:"map-options"},Ke={key:0,class:"travel-info"},Ge={class:"travel-cards"},Je={class:"info"},Oe={class:"distance"},Ze={class:"time"},Qe={class:"info"},et={class:"distance"},tt={class:"time"},ot={class:"info"},nt={class:"distance"},at={class:"time"},it={key:2,class:"weather-info"},st={class:"weather-content"},lt={class:"current-weather"},rt={class:"temperature"},dt={class:"weather"},ct={class:"weather-detail"},ut={__name:"index",setup(E){const{showToast:k,showLoadingToast:C}=Se();function S(t,e){let a=null;return function(...i){a&&clearTimeout(a),a=setTimeout(()=>{t.apply(this,i)},e)}}const p=d(""),_=d([]);let m=null;const c=d([]),w=$e(),r=d(null),g=d(""),M=d({driving:{distance:"等待搜索...",time:"等待搜索..."},riding:{distance:"等待搜索...",time:"等待搜索..."},walking:{distance:"等待搜索...",time:"等待搜索..."}}),b=d(""),P=d(!1),oe=d(!1),I=d(!0),z=d({top:"235px",right:"24px"}),q=d(!1),X=d(0),Y=d(0),K=d(0),G=d(0),ne=t=>{q.value=!0,X.value=t.touches[0].clientY,Y.value=t.touches[0].clientX,K.value=parseInt(z.value.top),G.value=parseInt(z.value.right)},ae=t=>{if(!q.value)return;const e=t.touches[0].clientY-X.value,a=t.touches[0].clientX-Y.value;let i=K.value+e,s=G.value-a;const n=window.innerHeight-50;i=Math.max(60,Math.min(i,n)),s=Math.max(0,Math.min(s,window.innerWidth-50)),z.value={top:`${i}px`,right:`${s}px`},t.cancelable&&requestAnimationFrame(()=>{t.preventDefault()})},ie=()=>{q.value=!1},A=d(!0),N=t=>{t===b.value&&A.value||(U(),b.value=t,A.value=!0,J(t))},U=()=>{window.driving&&window.driving.clear(),window.riding&&window.riding.clear(),window.walking&&window.walking.clear()},J=t=>{if(U(),!A.value)return;const e=window[t];if(e&&r.value&&window.marker){const a=window.marker.getPosition(),i=new AMap.LngLat(r.value[0],r.value[1]),s=new AMap.LngLat(a.getLng(),a.getLat());e.search(i,s,(n,v)=>{n==="complete"&&v.routes&&v.routes[0]?(e.clear(),e.search(i,s,{showMarker:!1,waypoints:[],autoFitView:!1})):console.error(`${t} 路线规划失败:`,n,v)})}},se=t=>{U(),window.marker&&window.marker.setMap(null);const e=new AMap.LngLat(t[0],t[1]);if(window.marker=new AMap.Marker({position:e,icon:new AMap.Icon({size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34),image:"//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-red.png"}),offset:new AMap.Pixel(-12,-34),zIndex:2}),window.marker.setMap(window.map),window.map.setCenter(e),r.value){const a=t[0]===r.value[0]&&t[1]===r.value[1];oe.value=!a,a||(le(t),A.value&&J(b.value))}},B=t=>t<1e3?`${Math.round(t)}米`:`${(t/1e3).toFixed(1)}公里`,H=t=>{const e=Math.floor(t/3600),a=Math.ceil(t%3600/60);return e>0?`约${e}小时${a}分钟`:`约${a}分钟`},R=()=>new Promise((t,e)=>{if(!p.value.trim())return k("请输入搜索地址"),Promise.reject("empty input");_.value=[],window.placeSearch.search(p.value,(a,i)=>{a==="complete"&&i.poiList&&i.poiList.pois&&i.poiList.pois.length>0?(c.value=i.poiList.pois.map(s=>({id:s.id||Math.random().toString(36).substr(2,9),name:s.name||"未知地点",address:s.address||"暂无地址",location:s.location?[s.location.lng,s.location.lat]:r.value})),c.value.length>0&&(P.value=!0,O(c.value[0],!0)),t()):(k("未找到相关地址"),c.value=[],e(new Error("搜索失败")))})}),le=t=>{if(!r.value)return;const e=new AMap.LngLat(r.value[0],r.value[1]),a=new AMap.LngLat(t[0],t[1]);window.driving.search(e,a,(i,s)=>{if(i==="complete"&&s.routes&&s.routes[0]){const n=s.routes[0];M.value.driving={distance:B(n.distance),time:H(n.time)}}}),window.riding.search(e,a,(i,s)=>{if(i==="complete"&&s.routes&&s.routes[0]){const n=s.routes[0];M.value.riding={distance:B(n.distance),time:H(n.time)}}}),window.walking.search(e,a,(i,s)=>{if(i==="complete"&&s.routes&&s.routes[0]){const n=s.routes[0];M.value.walking={distance:B(n.distance),time:H(n.time)}}})},re=()=>{if(I.value=!I.value,window.map){const t=I.value?45:0;window.map.setPitch(t)}},L=d(null),de=()=>{if(!window.AMap)return;new AMap.Weather().getLive("天津",(e,a)=>{e?console.error("获取天气信息失败：",e):L.value=a})},ce=async()=>{const t=C({message:"加载中...",forbidClick:!0});try{const{address:e}=w.query,a=[117.26673,39.069586];let i=a;if(!e&&navigator.geolocation)try{const y=await ue();i=[y.coords.longitude,y.coords.latitude]}catch(y){console.error("获取位置失败：",y),k("定位失败，使用默认位置"),i=a}r.value=i,window._AMapSecurityConfig={securityJsCode:"d71d134ad30466716eba94c299f43ee8"},await be.load({key:"d61c96ab9e393a548ca4d1e14272ce64",version:"2.0",plugins:["AMap.PlaceSearch","AMap.Scale","AMap.ToolBar","AMap.ControlBar","AMap.GeometryUtil","AMap.Driving","AMap.Walking","AMap.Riding","AMap.Weather","AMap.AutoComplete"]}),window.map=new AMap.Map("container",{viewMode:"3D",zoom:14,center:i,pitch:45});const s=new AMap.Scale({position:{left:"5px",bottom:"5px"}});window.map.addControl(s);const n=new AMap.ToolBar({position:{right:"28px",top:"100px"}});window.map.addControl(n);const v=new AMap.ControlBar({position:{right:"0px",top:"0px"}});window.map.addControl(v),window.placeSearch=new AMap.PlaceSearch({city:"天津",pageSize:10,pageIndex:1}),window.driving=new AMap.Driving({policy:AMap.DrivingPolicy.LEAST_TIME,map:window.map}),window.riding=new AMap.Riding({map:window.map}),window.walking=new AMap.Walking({map:window.map}),pe(r.value),e&&(p.value=e,P.value=!0,await R()),de(),m=new AMap.AutoComplete({city:"天津",citylimit:!0,input:""}),t(),D.value=!1}catch(e){console.error("地图初始化失败：",e),k("地图加载失败"),t(),D.value=!1}},ue=()=>new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(a=>t(a),a=>e(a),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}),pe=t=>{window.currentLocationMarker&&window.currentLocationMarker.setMap(null);const e=new AMap.LngLat(t[0],t[1]);window.currentLocationMarker=new AMap.Marker({position:e,icon:new AMap.Icon({size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34),image:"//webapi.amap.com/theme/v1.3/markers/b/mark_bs.png"}),offset:new AMap.Pixel(-12,-34),zIndex:1}),window.currentLocationMarker.setMap(window.map)},O=(t,e=!1)=>{e||(p.value=t.name),se(t.location),window.map.setZoom(14),P.value=!0,b.value=""},Z=S(async()=>{if(!p.value.trim()){_.value=[];return}m.search(p.value,(t,e)=>{t==="complete"&&e.tips?_.value=e.tips:_.value=[]})},300),me=t=>{if(!p.value.trim())return t;const e=p.value.trim(),a=new RegExp(e,"gi");return t.replace(a,i=>`<span class="highlight">${i}</span>`)},ve=t=>{p.value=t.name,_.value=[],R()};fe(()=>{ce(),document.addEventListener("click",t=>{const e=document.querySelector(".search-box");e!=null&&e.contains(t.target)||(_.value=[])})}),he(()=>{window.map&&(window.map.destroy(),window.map=null,window.marker=null,window.currentLocationMarker=null,window.placeSearch=null,window.driving=null,window.riding=null,window.walking=null)});const D=d(!0),V=t=>{if(!window.marker){k("请先选择目的地");return}const e=window.marker.getPosition(),a=e.getLat(),i=e.getLng(),s=p.value;let n="",v="";switch(t){case"gaode":n=`androidamap://route/plan/?dlat=${a}&dlon=${i}&dname=${encodeURIComponent(s)}&dev=0&t=0`,v="高德地图";break;case"baidu":n=`baidumap://map/direction?destination=${a},${i}&destination_name=${encodeURIComponent(s)}&mode=driving&coord_type=gcj02`,v="百度地图";break;case"tencent":n=`qqmap://map/routeplan?type=drive&to=${encodeURIComponent(s)}&tocoord=${a},${i}&referer=myapp`,v="腾讯地图";break}let y="";switch(t){case"gaode":y=`https://uri.amap.com/route/plan/?dlat=${a}&dlon=${i}&dname=${encodeURIComponent(s)}&dev=0&t=0`;break;case"baidu":y=`https://api.map.baidu.com/direction?destination=${a},${i}&destination_name=${encodeURIComponent(s)}&mode=driving&output=html&src=webapp.baidu.openAPIdemo`;break;case"tencent":y=`https://map.qq.com/dir/?type=drive&to=${encodeURIComponent(s)}&tocoord=${a},${i}&referer=myapp`;break}k(`正在尝试打开${v}，如未安装将跳转至网页版`),setTimeout(()=>{if(we())window.location.href=n,setTimeout(()=>{document.hidden||(window.location.href=y)},2500);else{const W=window.open(n);setTimeout(()=>{W&&!W.closed&&(W.close(),window.location.href=y)},2500)}},1500),T.value=!1},T=d(!1),we=()=>/MicroMessenger/i.test(navigator.userAgent),ge=()=>{if(!window.marker){k("请先选择目的地");return}T.value=!0};return(t,e)=>{const a=Ae,i=Te,s=Le;return h(),f("div",Pe,[o("div",Ie,[o("div",ze,[o("div",Re,[ke(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>Q(p)?p.value=n:null),placeholder:"请输入地址",class:"search-input",onKeyup:Me(R,["enter"]),onInput:e[1]||(e[1]=(...n)=>l(Z)&&l(Z)(...n))},null,544),[[ye,l(p)]]),l(_).length?(h(),f("div",De,[(h(!0),f(j,null,ee(l(_),(n,v)=>(h(),f("div",{key:v,class:"tip-item",onClick:y=>ve(n)},[o("div",{class:"name",innerHTML:me(n.name)},null,8,qe),o("div",Ne,u(n.district),1)],8,Ee))),128))])):x("",!0)]),o("button",{class:"search-btn",onClick:R},"搜索")])]),e[18]||(e[18]=o("div",{id:"container"},null,-1)),l(g)?(h(),f("div",Ue,[$(a,{title:l(g)},null,8,["title"])])):x("",!0),l(D)?x("",!0):(h(),f("div",{key:1,class:"view-toggle-btn",onClick:re},[o("span",Be,u(l(I)?"3D":"2D"),1)])),o("div",He,[l(D)?x("",!0):(h(),f(j,{key:0},[l(c).length?(h(!0),f(j,{key:0},ee(l(c),n=>(h(),f("div",{key:n.id,class:"address-item",onClick:v=>O(n)},[o("div",We,u(n.name),1),o("div",je,u(n.address),1)],8,Ve))),128)):(h(),f("div",Fe,e[10]||(e[10]=[o("img",{src:"https://fastly.jsdelivr.net/npm/@vant/assets/custom-empty-image.png",class:"empty-image"},null,-1),o("p",{class:"empty-text"},"暂无地址数据",-1)])))],64))]),o("div",{class:"nav-btn",onTouchstartPassive:ne,onTouchmovePassive:ae,onTouchendPassive:ie,style:_e(l(z)),onClick:ge},[$(i,{name:"guide-o",size:"24"})],36),$(s,{show:l(T),"onUpdate:show":e[6]||(e[6]=n=>Q(T)?T.value=n:null),round:"",position:"bottom"},{default:te(()=>[o("div",Xe,[e[14]||(e[14]=o("div",{class:"selector-title"},"选择导航应用",-1)),o("div",Ye,[o("div",{class:"map-option",onClick:e[2]||(e[2]=n=>V("gaode"))},[$(i,{name:"guide-o",size:"24",color:"#2aae67"}),e[11]||(e[11]=o("span",null,"高德地图",-1))]),o("div",{class:"map-option",onClick:e[3]||(e[3]=n=>V("baidu"))},[$(i,{name:"location-o",size:"24",color:"#3385ff"}),e[12]||(e[12]=o("span",null,"百度地图",-1))]),o("div",{class:"map-option",onClick:e[4]||(e[4]=n=>V("tencent"))},[$(i,{name:"location",size:"24",color:"#4b90fd"}),e[13]||(e[13]=o("span",null,"腾讯地图",-1))])]),o("div",{class:"cancel-btn",onClick:e[5]||(e[5]=n=>T.value=!1)},"取消")])]),_:1},8,["show"]),$(Ce,{name:"slide"},{default:te(()=>[l(P)&&l(M).driving?(h(),f("div",Ke,[o("div",Ge,[o("div",{class:F(["travel-card",{active:l(b)==="driving"&&l(A)}]),onClick:e[7]||(e[7]=n=>N("driving"))},[e[15]||(e[15]=o("div",{class:"mode-icon"},"🚗",-1)),o("div",Je,[o("div",Oe,u(l(M).driving.distance),1),o("div",Ze,u(l(M).driving.time),1)])],2),o("div",{class:F(["travel-card",{active:l(b)==="riding"&&l(A)}]),onClick:e[8]||(e[8]=n=>N("riding"))},[e[16]||(e[16]=o("div",{class:"mode-icon"},"🚲",-1)),o("div",Qe,[o("div",et,u(l(M).riding.distance),1),o("div",tt,u(l(M).riding.time),1)])],2),o("div",{class:F(["travel-card",{active:l(b)==="walking"&&l(A)}]),onClick:e[9]||(e[9]=n=>N("walking"))},[e[17]||(e[17]=o("div",{class:"mode-icon"},"🚶",-1)),o("div",ot,[o("div",nt,u(l(M).walking.distance),1),o("div",at,u(l(M).walking.time),1)])],2)])])):x("",!0)]),_:1}),l(L)?(h(),f("div",it,[o("div",st,[o("div",lt,[o("span",rt,u(l(L).temperature)+"°",1),o("span",dt,u(l(L).weather),1)]),o("div",ct,[o("span",null,"湿度 "+u(l(L).humidity)+"%",1),o("span",null,u(l(L).windDirection)+"风 "+u(l(L).windPower)+"级",1)])])])):x("",!0)])}}},vt=xe(ut,[["__scopeId","data-v-329a896b"]]);export{vt as default};
