import{r as l,q as te,s as ie,l as k,m as r,e as m,d as y,f as t,v as H,h as P,x as se,T as re,y as x,A as le,B as ce,C as de,S as ue,D as we,L as ve,O as pe,o as f,F as me,G as ge,H as $,t as h,u as fe,I as he,J as Me,c as _e}from"./vendor.Bd9vWuj8.js";import{_ as ke}from"./index.0KAHMmrS.js";const Ae={class:"map-search"},Le={class:"search-box"},Se={key:0,class:"distance-info"},ye={class:"address-list"},Pe={key:0,class:"travel-info"},xe={class:"travel-cards"},Ce={class:"info"},Te={class:"distance"},ze={class:"time"},be={class:"info"},Ie={class:"distance"},Re={class:"time"},Be={class:"info"},$e={class:"distance"},De={class:"time"},Ve={__name:"index",setup(Ee){const w=l(""),A=l(!1),D=l(!1),M=l([]),C=l(!0),N=fe(),c=l(null),T=l(""),u=l({driving:{distance:"等待搜索...",time:"等待搜索..."},riding:{distance:"等待搜索...",time:"等待搜索..."},walking:{distance:"等待搜索...",time:"等待搜索..."}}),v=l(""),g=l(!1),V=l(!1),L=l({top:"120px",right:"15px"}),S=l(!1),E=l(0),F=l(0),q=l(0),U=l(0),W=e=>{S.value=!0,E.value=e.touches[0].clientY,F.value=e.touches[0].clientX,q.value=parseInt(L.value.top),U.value=parseInt(L.value.right)},G=e=>{if(!S.value)return;const n=e.touches[0].clientY-E.value,o=e.touches[0].clientX-F.value;let i=q.value+n,a=U.value-o;const s=window.innerHeight-50;i=Math.max(60,Math.min(i,s)),a=Math.max(0,Math.min(a,window.innerWidth-50)),L.value={top:`${i}px`,right:`${a}px`},e.cancelable&&requestAnimationFrame(()=>{e.preventDefault()})},J=()=>{S.value=!1},p=l(!0),O=e=>{if(S.value){e.stopPropagation();return}g.value=!g.value},z=e=>{e===v.value&&p.value||(b(),v.value=e,p.value=!0,X(e))},b=()=>{window.driving&&window.driving.clear(),window.riding&&window.riding.clear(),window.walking&&window.walking.clear()},X=e=>{if(b(),!p.value)return;const n=window[e];if(n&&c.value&&window.marker){const o=window.marker.getPosition(),i=new AMap.LngLat(c.value[0],c.value[1]),a=new AMap.LngLat(o.getLng(),o.getLat());n.search(i,a,(s,_)=>{s==="complete"&&_.routes&&_.routes[0]?(n.clear(),n.search(i,a,{showMarker:!1,waypoints:[],autoFitView:!1})):console.error(`${e} 路线规划失败:`,s,_)})}},Z=e=>{b(),window.marker&&window.marker.setMap(null);const n=new AMap.LngLat(e[0],e[1]);if(window.marker=new AMap.Marker({position:n,icon:new AMap.Icon({size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34),image:"//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-red.png"}),offset:new AMap.Pixel(-12,-34),zIndex:2}),window.marker.setMap(window.map),window.map.setCenter(n),c.value){const o=e[0]===c.value[0]&&e[1]===c.value[1];V.value=!o,o||(Q(e),p.value&&X(v.value))}},I=e=>e<1e3?`${Math.round(e)}米`:`${(e/1e3).toFixed(1)}公里`,R=e=>{const n=Math.floor(e/3600),o=Math.ceil(e%3600/60);return n>0?`约${n}小时${o}分钟`:`约${o}分钟`},B=()=>new Promise((e,n)=>{if(!w.value){x("请输入搜索地址"),n(new Error("空地址"));return}window.placeSearch.search(w.value,(o,i)=>{o==="complete"&&i.poiList&&i.poiList.pois&&i.poiList.pois.length>0?(M.value=i.poiList.pois.map(a=>({id:a.id||Math.random().toString(36).substr(2,9),name:a.name||"未知地点",address:a.address||"暂无地址",location:a.location?[a.location.lng,a.location.lat]:c.value})),M.value.length>0&&(g.value=!0,Y(M.value[0],!0)),e()):(x("未找到相关地址"),n(new Error("搜索失败")))})}),j=e=>{e||(M.value=[],document.activeElement===document.querySelector(".van-search__field input")&&(T.value=""))},K=()=>{A.value=!1,D.value=!0},Q=e=>{if(!c.value)return;const n=new AMap.LngLat(c.value[0],c.value[1]),o=new AMap.LngLat(e[0],e[1]);window.driving.search(n,o,(i,a)=>{if(i==="complete"&&a.routes&&a.routes[0]){const s=a.routes[0];u.value.driving={distance:I(s.distance),time:R(s.time)}}}),window.riding.search(n,o,(i,a)=>{if(i==="complete"&&a.routes&&a.routes[0]){const s=a.routes[0];u.value.riding={distance:I(s.distance),time:R(s.time)}}}),window.walking.search(n,o,(i,a)=>{if(i==="complete"&&a.routes&&a.routes[0]){const s=a.routes[0];u.value.walking={distance:I(s.distance),time:R(s.time)}}})},ee=async()=>{le({message:"加载中...",forbidClick:!0,duration:0});try{const{address:e}=N.query,n=[117.26673,39.069586];let o=n;if(!e&&navigator.geolocation)try{const s=await ne();o=[s.coords.longitude,s.coords.latitude]}catch(s){console.error("获取位置失败：",s),x("定位失败，使用默认位置"),o=n}c.value=o,window._AMapSecurityConfig={securityJsCode:"d71d134ad30466716eba94c299f43ee8"},await ce.load({key:"d61c96ab9e393a548ca4d1e14272ce64",version:"2.0",plugins:["AMap.PlaceSearch","AMap.Scale","AMap.ToolBar","AMap.GeometryUtil","AMap.Driving","AMap.Walking","AMap.Riding"]}),window.map=new AMap.Map("container",{viewMode:"3D",zoom:16,center:o});const i=new AMap.Scale({position:"LB"});window.map.addControl(i);const a=new AMap.ToolBar({position:"RB",offset:new AMap.Pixel(10,40),showZoomBar:!0,showControlButton:!1,theme:"light"});window.map.addControl(a),window.placeSearch=new AMap.PlaceSearch({city:"天津",pageSize:10,pageIndex:1}),window.driving=new AMap.Driving({policy:AMap.DrivingPolicy.LEAST_TIME,map:window.map}),window.riding=new AMap.Riding({map:window.map}),window.walking=new AMap.Walking({map:window.map}),ae(c.value),e&&(w.value=e,g.value=!0,await B()),de(),C.value=!1}catch(e){console.error("地图初始化失败：",e),x("地图加载失败"),C.value=!1}},ne=()=>new Promise((e,n)=>{navigator.geolocation.getCurrentPosition(o=>e(o),o=>n(o),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}),ae=e=>{window.currentLocationMarker&&window.currentLocationMarker.setMap(null);const n=new AMap.LngLat(e[0],e[1]);window.currentLocationMarker=new AMap.Marker({position:n,icon:new AMap.Icon({size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34),image:"//webapi.amap.com/theme/v1.3/markers/b/mark_bs.png"}),offset:new AMap.Pixel(-12,-34),zIndex:1}),window.currentLocationMarker.setMap(window.map)},Y=(e,n=!1)=>{n||(w.value=e.name),Z(e.location),window.map.setZoom(17),g.value=!0,v.value=""};return te(()=>{ee()}),ie(()=>{window.map&&(window.map.destroy(),window.map=null,window.marker=null,window.currentLocationMarker=null,window.placeSearch=null,window.driving=null,window.riding=null,window.walking=null)}),(e,n)=>{const o=ue,i=we,a=ve,s=he,_=Me,oe=pe;return f(),k("div",Ae,[r("div",Le,[m(o,{modelValue:t(w),"onUpdate:modelValue":[n[0]||(n[0]=d=>H(w)?w.value=d:null),j],placeholder:"请输入地址","show-action":"",onSearch:B},{action:y(()=>[r("span",{onClick:B},"搜索")]),_:1},8,["modelValue"])]),n[8]||(n[8]=r("div",{id:"container"},null,-1)),t(T)?(f(),k("div",Se,[m(i,{title:t(T)},null,8,["title"])])):P("",!0),r("div",ye,[m(a,{loading:t(A),"onUpdate:loading":n[1]||(n[1]=d=>H(A)?A.value=d:null),finished:t(D),"finished-text":"没有更多了",onLoad:K},{default:y(()=>[(f(!0),k(me,null,ge(t(M),d=>(f(),_e(i,{key:d.id,title:d.name,label:d.address,onClick:Fe=>Y(d)},null,8,["title","label","onClick"]))),128))]),_:1},8,["loading","finished"])]),t(V)?(f(),k("div",{key:1,class:"route-btn",onClick:O,onTouchstartPassive:W,onTouchmovePassive:G,onTouchendPassive:J,style:se(t(L))},[m(s,{name:"guide-o",size:"24"})],36)):P("",!0),P("",!0),m(re,{name:"slide"},{default:y(()=>[t(g)&&t(u).driving?(f(),k("div",Pe,[r("div",xe,[r("div",{class:$(["travel-card",{active:t(v)==="driving"&&t(p)}]),onClick:n[2]||(n[2]=d=>z("driving"))},[n[5]||(n[5]=r("div",{class:"mode-icon"},"🚗",-1)),r("div",Ce,[r("div",Te,h(t(u).driving.distance),1),r("div",ze,h(t(u).driving.time),1)])],2),r("div",{class:$(["travel-card",{active:t(v)==="riding"&&t(p)}]),onClick:n[3]||(n[3]=d=>z("riding"))},[n[6]||(n[6]=r("div",{class:"mode-icon"},"🚲",-1)),r("div",be,[r("div",Ie,h(t(u).riding.distance),1),r("div",Re,h(t(u).riding.time),1)])],2),r("div",{class:$(["travel-card",{active:t(v)==="walking"&&t(p)}]),onClick:n[4]||(n[4]=d=>z("walking"))},[n[7]||(n[7]=r("div",{class:"mode-icon"},"🚶",-1)),r("div",Be,[r("div",$e,h(t(u).walking.distance),1),r("div",De,h(t(u).walking.time),1)])],2)])])):P("",!0)]),_:1}),m(oe,{show:t(C),class:"loading-overlay"},{default:y(()=>[m(_,{type:"spinner",color:"#1989fa"})]),_:1},8,["show"])])}}},Xe=ke(Ve,[["__scopeId","data-v-22a69589"]]);export{Xe as default};
