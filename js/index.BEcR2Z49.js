import{r as c,q as ge,s as fe,l as h,m as o,v as he,x as ke,f as l,y as Z,A as ye,F as W,B as Q,h as T,e as $,t as u,C as Me,d as ee,T as _e,D as Ce,G as Ae,P as be,o as k,H as j,u as Le,I as $e}from"./vendor.PTwOvzD9.js";import{_ as xe}from"./index.OFsjwzqa.js";function Te(){const E=c(!1),w=c(""),C=c(!1);let P=null;return{showToast:m=>{if(P){clearTimeout(P);const r=document.querySelector(".custom-toast");r&&document.body.removeChild(r)}typeof m=="string"?(w.value=m,C.value=!1):(w.value=m.message,C.value=m.forbidClick||!1);const d=document.createElement("div");if(d.className="custom-toast",d.textContent=w.value,C.value){const r=document.createElement("div");r.className="toast-overlay",document.body.appendChild(r)}document.body.appendChild(d),E.value=!0,d.offsetHeight,d.style.opacity="1";const g=typeof m=="object"&&m.duration||2500;P=window.setTimeout(()=>{d.classList.add("fade-out"),setTimeout(()=>{if(document.body.removeChild(d),C.value){const r=document.querySelector(".toast-overlay");r&&document.body.removeChild(r)}E.value=!1,C.value=!1},200)},g)},showLoadingToast:m=>{console.log("显示 loading:",m);const d=typeof m=="string"?{message:m,forbidClick:!0}:{...m,forbidClick:!0},g=document.createElement("div");g.className="custom-toast loading-toast";const r=document.createElement("div");if(r.className="loading-spinner",g.appendChild(r),d.message){const f=document.createElement("div");f.className="loading-message",f.textContent=d.message,g.appendChild(f)}if(d.forbidClick){const f=document.createElement("div");f.className="toast-overlay",document.body.appendChild(f)}return document.body.appendChild(g),g.offsetHeight,g.style.opacity="1",()=>{g.classList.add("fade-out"),setTimeout(()=>{document.body.removeChild(g);const f=document.querySelector(".toast-overlay");f&&document.body.removeChild(f)},200)}}}}const Pe={class:"map-search"},Se={class:"search-box"},Ie={class:"search-input-wrapper"},ze={class:"input-container"},Re={key:0,class:"search-tips"},De=["onClick"],Ee=["innerHTML"],qe={class:"district"},Ue={key:0,class:"distance-info"},Be={class:"view-text"},Ne={class:"address-list"},He=["onClick"],Ve={class:"title"},We={class:"label"},je={key:1,class:"empty-status"},Fe={class:"map-selector"},Xe={class:"map-options"},Ye={key:0,class:"travel-info"},Ke={class:"travel-cards"},Ge={class:"info"},Je={class:"distance"},Oe={class:"time"},Ze={class:"info"},Qe={class:"distance"},et={class:"time"},tt={class:"info"},ot={class:"distance"},nt={class:"time"},at={key:2,class:"weather-info"},it={class:"weather-content"},st={class:"current-weather"},lt={class:"temperature"},rt={class:"weather"},ct={class:"weather-detail"},dt={__name:"index",setup(E){const{showToast:w,showLoadingToast:C}=Te();function P(t,e){let a=null;return function(...i){a&&clearTimeout(a),a=setTimeout(()=>{t.apply(this,i)},e)}}const p=c(""),M=c([]);let m=null;const d=c([]),g=Le(),r=c(null),f=c(""),y=c({driving:{distance:"等待搜索...",time:"等待搜索..."},riding:{distance:"等待搜索...",time:"等待搜索..."},walking:{distance:"等待搜索...",time:"等待搜索..."}}),A=c(""),S=c(!1),te=c(!1),I=c(!0),z=c({top:"235px",right:"24px"}),q=c(!1),F=c(0),X=c(0),Y=c(0),K=c(0),oe=t=>{q.value=!0,F.value=t.touches[0].clientY,X.value=t.touches[0].clientX,Y.value=parseInt(z.value.top),K.value=parseInt(z.value.right)},ne=t=>{if(!q.value)return;const e=t.touches[0].clientY-F.value,a=t.touches[0].clientX-X.value;let i=Y.value+e,s=K.value-a;const n=window.innerHeight-50;i=Math.max(60,Math.min(i,n)),s=Math.max(0,Math.min(s,window.innerWidth-50)),z.value={top:`${i}px`,right:`${s}px`},t.cancelable&&requestAnimationFrame(()=>{t.preventDefault()})},ae=()=>{q.value=!1},b=c(!0),U=t=>{t===A.value&&b.value||(B(),A.value=t,b.value=!0,G(t))},B=()=>{window.driving&&window.driving.clear(),window.riding&&window.riding.clear(),window.walking&&window.walking.clear()},G=t=>{if(B(),!b.value)return;const e=window[t];if(e&&r.value&&window.marker){const a=window.marker.getPosition(),i=new AMap.LngLat(r.value[0],r.value[1]),s=new AMap.LngLat(a.getLng(),a.getLat());e.search(i,s,(n,v)=>{n==="complete"&&v.routes&&v.routes[0]?(e.clear(),e.search(i,s,{showMarker:!1,waypoints:[],autoFitView:!1})):console.error(`${t} 路线规划失败:`,n,v)})}},ie=t=>{B(),window.marker&&window.marker.setMap(null);const e=new AMap.LngLat(t[0],t[1]);if(window.marker=new AMap.Marker({position:e,icon:new AMap.Icon({size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34),image:"//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-red.png"}),offset:new AMap.Pixel(-12,-34),zIndex:2}),window.marker.setMap(window.map),window.map.setCenter(e),r.value){const a=t[0]===r.value[0]&&t[1]===r.value[1];te.value=!a,a||(se(t),b.value&&G(A.value))}},N=t=>t<1e3?`${Math.round(t)}米`:`${(t/1e3).toFixed(1)}公里`,H=t=>{const e=Math.floor(t/3600),a=Math.ceil(t%3600/60);return e>0?`约${e}小时${a}分钟`:`约${a}分钟`},R=()=>new Promise((t,e)=>{if(!p.value.trim())return w("请输入搜索地址"),Promise.reject("empty input");M.value=[],window.placeSearch.search(p.value,(a,i)=>{a==="complete"&&i.poiList&&i.poiList.pois&&i.poiList.pois.length>0?(d.value=i.poiList.pois.map(s=>({id:s.id||Math.random().toString(36).substr(2,9),name:s.name||"未知地点",address:s.address||"暂无地址",location:s.location?[s.location.lng,s.location.lat]:r.value})),d.value.length>0&&(S.value=!0,J(d.value[0],!0)),t()):(w("未找到相关地址"),d.value=[],e(new Error("搜索失败")))})}),se=t=>{if(!r.value)return;const e=new AMap.LngLat(r.value[0],r.value[1]),a=new AMap.LngLat(t[0],t[1]);window.driving.search(e,a,(i,s)=>{if(i==="complete"&&s.routes&&s.routes[0]){const n=s.routes[0];y.value.driving={distance:N(n.distance),time:H(n.time)}}}),window.riding.search(e,a,(i,s)=>{if(i==="complete"&&s.routes&&s.routes[0]){const n=s.routes[0];y.value.riding={distance:N(n.distance),time:H(n.time)}}}),window.walking.search(e,a,(i,s)=>{if(i==="complete"&&s.routes&&s.routes[0]){const n=s.routes[0];y.value.walking={distance:N(n.distance),time:H(n.time)}}})},le=()=>{if(I.value=!I.value,window.map){const t=I.value?45:0;window.map.setPitch(t)}},L=c(null),re=()=>{if(!window.AMap)return;new AMap.Weather().getLive("天津",(e,a)=>{e?console.error("获取天气信息失败：",e):L.value=a})},ce=async()=>{const t=C({message:"加载中...",forbidClick:!0});try{const{address:e}=g.query,a=[117.26673,39.069586];let i=a;if(!e&&navigator.geolocation)try{const _=await de();i=[_.coords.longitude,_.coords.latitude]}catch(_){console.error("获取位置失败：",_),w("定位失败，使用默认位置"),i=a}r.value=i,window._AMapSecurityConfig={securityJsCode:"d71d134ad30466716eba94c299f43ee8"},await Ce.load({key:"d61c96ab9e393a548ca4d1e14272ce64",version:"2.0",plugins:["AMap.PlaceSearch","AMap.Scale","AMap.ToolBar","AMap.ControlBar","AMap.GeometryUtil","AMap.Driving","AMap.Walking","AMap.Riding","AMap.Weather","AMap.AutoComplete"]}),window.map=new AMap.Map("container",{viewMode:"3D",zoom:14,center:i,pitch:45});const s=new AMap.Scale({position:{left:"5px",bottom:"5px"}});window.map.addControl(s);const n=new AMap.ToolBar({position:{right:"28px",top:"100px"}});window.map.addControl(n);const v=new AMap.ControlBar({position:{right:"0px",top:"0px"}});window.map.addControl(v),window.placeSearch=new AMap.PlaceSearch({city:"天津",pageSize:10,pageIndex:1}),window.driving=new AMap.Driving({policy:AMap.DrivingPolicy.LEAST_TIME,map:window.map}),window.riding=new AMap.Riding({map:window.map}),window.walking=new AMap.Walking({map:window.map}),ue(r.value),e&&(p.value=e,S.value=!0,await R()),re(),m=new AMap.AutoComplete({city:"天津",citylimit:!0,input:""}),t(),D.value=!1}catch(e){console.error("地图初始化失败：",e),w("地图加载失败"),t(),D.value=!1}},de=()=>new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(a=>t(a),a=>e(a),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}),ue=t=>{window.currentLocationMarker&&window.currentLocationMarker.setMap(null);const e=new AMap.LngLat(t[0],t[1]);window.currentLocationMarker=new AMap.Marker({position:e,icon:new AMap.Icon({size:new AMap.Size(25,34),imageSize:new AMap.Size(25,34),image:"//webapi.amap.com/theme/v1.3/markers/b/mark_bs.png"}),offset:new AMap.Pixel(-12,-34),zIndex:1}),window.currentLocationMarker.setMap(window.map)},J=(t,e=!1)=>{e||(p.value=t.name),ie(t.location),window.map.setZoom(14),S.value=!0,A.value=""},O=P(async()=>{if(!p.value.trim()){M.value=[];return}m.search(p.value,(t,e)=>{t==="complete"&&e.tips?M.value=e.tips:M.value=[]})},300),pe=t=>{if(!p.value.trim())return t;const e=p.value.trim(),a=new RegExp(e,"gi");return t.replace(a,i=>`<span class="highlight">${i}</span>`)},me=t=>{p.value=t.name,M.value=[],R()};ge(()=>{ce(),document.addEventListener("click",t=>{const e=document.querySelector(".search-box");e!=null&&e.contains(t.target)||(M.value=[])})}),fe(()=>{window.map&&(window.map.destroy(),window.map=null,window.marker=null,window.currentLocationMarker=null,window.placeSearch=null,window.driving=null,window.riding=null,window.walking=null)});const D=c(!0),V=t=>{if(!window.marker){w("请先选择目的地");return}const e=window.marker.getPosition(),a=e.getLat(),i=e.getLng(),s=p.value;let n="";switch(t){case"gaode":n=`androidamap://navi?sourceApplication=appname&poiname=${encodeURIComponent(s)}&lat=${a}&lon=${i}&dev=0&style=2`;break;case"baidu":n=`baidumap://map/direction?destination=${a},${i}&destination_name=${encodeURIComponent(s)}&mode=driving&coord_type=gcj02`;break;case"tencent":n=`qqmap://map/routeplan?type=drive&to=${encodeURIComponent(s)}&tocoord=${a},${i}&referer=myapp`;break}let v="";switch(t){case"gaode":v=`https://uri.amap.com/navigation?to=${i},${a},${encodeURIComponent(s)}&mode=car&coordinate=gaode&callnative=1`;break;case"baidu":v=`https://api.map.baidu.com/direction?destination=${a},${i}&destination_name=${encodeURIComponent(s)}&mode=driving&output=html&src=webapp.baidu.openAPIdemo`;break;case"tencent":v=`https://map.qq.com/dir/?type=drive&to=${encodeURIComponent(s)}&tocoord=${a},${i}&referer=myapp`;break}if(ve())window.location.href=n,setTimeout(()=>{document.hidden||(window.location.href=v,w("未安装对应地图APP，已为您跳转到网页版"))},2500);else{const _=window.open(n);setTimeout(()=>{_&&!_.closed&&(_.close(),window.location.href=v,w("未安装对应地图APP，已为您跳转到网页版"))},2500)}x.value=!1},x=c(!1),ve=()=>/MicroMessenger/i.test(navigator.userAgent),we=()=>{if(!window.marker){w("请先选择目的地");return}x.value=!0};return(t,e)=>{const a=Ae,i=$e,s=be;return k(),h("div",Pe,[o("div",Se,[o("div",Ie,[o("div",ze,[he(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=n=>Z(p)?p.value=n:null),placeholder:"请输入地址",class:"search-input",onKeyup:ye(R,["enter"]),onInput:e[1]||(e[1]=(...n)=>l(O)&&l(O)(...n))},null,544),[[ke,l(p)]]),l(M).length?(k(),h("div",Re,[(k(!0),h(W,null,Q(l(M),(n,v)=>(k(),h("div",{key:v,class:"tip-item",onClick:_=>me(n)},[o("div",{class:"name",innerHTML:pe(n.name)},null,8,Ee),o("div",qe,u(n.district),1)],8,De))),128))])):T("",!0)]),o("button",{class:"search-btn",onClick:R},"搜索")])]),e[18]||(e[18]=o("div",{id:"container"},null,-1)),l(f)?(k(),h("div",Ue,[$(a,{title:l(f)},null,8,["title"])])):T("",!0),l(D)?T("",!0):(k(),h("div",{key:1,class:"view-toggle-btn",onClick:le},[o("span",Be,u(l(I)?"3D":"2D"),1)])),o("div",Ne,[l(D)?T("",!0):(k(),h(W,{key:0},[l(d).length?(k(!0),h(W,{key:0},Q(l(d),n=>(k(),h("div",{key:n.id,class:"address-item",onClick:v=>J(n)},[o("div",Ve,u(n.name),1),o("div",We,u(n.address),1)],8,He))),128)):(k(),h("div",je,e[10]||(e[10]=[o("img",{src:"https://fastly.jsdelivr.net/npm/@vant/assets/custom-empty-image.png",class:"empty-image"},null,-1),o("p",{class:"empty-text"},"暂无地址数据",-1)])))],64))]),o("div",{class:"nav-btn",onTouchstartPassive:oe,onTouchmovePassive:ne,onTouchendPassive:ae,style:Me(l(z)),onClick:we},[$(i,{name:"guide-o",size:"24"})],36),$(s,{show:l(x),"onUpdate:show":e[6]||(e[6]=n=>Z(x)?x.value=n:null),round:"",position:"bottom"},{default:ee(()=>[o("div",Fe,[e[14]||(e[14]=o("div",{class:"selector-title"},"选择导航应用",-1)),o("div",Xe,[o("div",{class:"map-option",onClick:e[2]||(e[2]=n=>V("gaode"))},[$(i,{name:"guide-o",size:"24",color:"#2aae67"}),e[11]||(e[11]=o("span",null,"高德地图",-1))]),o("div",{class:"map-option",onClick:e[3]||(e[3]=n=>V("baidu"))},[$(i,{name:"location-o",size:"24",color:"#3385ff"}),e[12]||(e[12]=o("span",null,"百度地图",-1))]),o("div",{class:"map-option",onClick:e[4]||(e[4]=n=>V("tencent"))},[$(i,{name:"location",size:"24",color:"#4b90fd"}),e[13]||(e[13]=o("span",null,"腾讯地图",-1))])]),o("div",{class:"cancel-btn",onClick:e[5]||(e[5]=n=>x.value=!1)},"取消")])]),_:1},8,["show"]),$(_e,{name:"slide"},{default:ee(()=>[l(S)&&l(y).driving?(k(),h("div",Ye,[o("div",Ke,[o("div",{class:j(["travel-card",{active:l(A)==="driving"&&l(b)}]),onClick:e[7]||(e[7]=n=>U("driving"))},[e[15]||(e[15]=o("div",{class:"mode-icon"},"🚗",-1)),o("div",Ge,[o("div",Je,u(l(y).driving.distance),1),o("div",Oe,u(l(y).driving.time),1)])],2),o("div",{class:j(["travel-card",{active:l(A)==="riding"&&l(b)}]),onClick:e[8]||(e[8]=n=>U("riding"))},[e[16]||(e[16]=o("div",{class:"mode-icon"},"🚲",-1)),o("div",Ze,[o("div",Qe,u(l(y).riding.distance),1),o("div",et,u(l(y).riding.time),1)])],2),o("div",{class:j(["travel-card",{active:l(A)==="walking"&&l(b)}]),onClick:e[9]||(e[9]=n=>U("walking"))},[e[17]||(e[17]=o("div",{class:"mode-icon"},"🚶",-1)),o("div",tt,[o("div",ot,u(l(y).walking.distance),1),o("div",nt,u(l(y).walking.time),1)])],2)])])):T("",!0)]),_:1}),l(L)?(k(),h("div",at,[o("div",it,[o("div",st,[o("span",lt,u(l(L).temperature)+"°",1),o("span",rt,u(l(L).weather),1)]),o("div",ct,[o("span",null,"湿度 "+u(l(L).humidity)+"%",1),o("span",null,u(l(L).windDirection)+"风 "+u(l(L).windPower)+"级",1)])])])):T("",!0)])}}},mt=xe(dt,[["__scopeId","data-v-9f22e726"]]);export{mt as default};
